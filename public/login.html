<!DOCTYPE html>
<html>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Login to MSTeamsClone</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.min.js" integrity="sha384-Atwg2Pkwv9vp0ygtn1JAojH0nYbwNJLPhwyoVbhoPwBhjQPR5VtM2+xf0Uwh9KtT" crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <link rel="shortcut icon" href="#">
      <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script> 
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <link rel="stylesheet" type="text/css" href="login.css">
    
</head>
<body onload="logoutUser()">
    <div style="height:100vh; width:100vw">    
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">MSTeams Clone</a>            
        </div>
      </nav>       
        <h1 class="pt-5">Welcome to MS Teams Clone!</h1>
        <h2 class="mb-4">You need to sign in first:</h2>
        <form >
            <div class="mb-3">
            <label for="InputEmail1" class="form-label"><b>Email address:</b></label>
            <input type="email" class="form-control" id="InputEmail1" placeholder="Enter your email ID" aria-describedby="emailHelp">
            <div id="emailHelp" class="form-text">If you don't have an account, Sign up first!</div>
            </div>          
            <div class="mb-3">
            <label for="InputPassword1" class="form-label"><b>Password:</b></label>
            <input type="password" class="form-control" placeholder="Enter password" id="InputPassword1">
            </div>        
            <button id="loginbtn" class="btn btn-primary">Log In</button>
            <button id="signupbtn" class="btn btn-dark">Sign Up</button>
        </form>
</div>
<div id="myModal" class="modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Oops! An Error occured</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">   
            <p id="errormessage"></p>       
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>          
        </div>
      </div>
    </div>
  </div>
    

<script>
  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  var firebaseConfig = {
    apiKey: "AIzaSyCm27xJOmzApVjEbQYSZISg1RbWaumAp7g",
    authDomain: "fir-rtc-ff458.firebaseapp.com",
    projectId: "fir-rtc-ff458",
    storageBucket: "fir-rtc-ff458.appspot.com",
    messagingSenderId: "368699893015",
    appId: "1:368699893015:web:3f07c542726f4440748352",
    measurementId: "G-QFX02TVEB7"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig); 
</script>
<script>
    const email=document.getElementById('InputEmail1');
    const password=document.getElementById('InputPassword1');
    const loginbtn=document.getElementById('loginbtn');
    const signupbtn=document.getElementById('signupbtn');
    const auth=firebase.auth();

    loginbtn.addEventListener('click',event=>{
        event.preventDefault();
        const emailID=email.value;
        const Password=password.value;
        console.log('login');
        const promise=auth.signInWithEmailAndPassword(emailID,Password)
        .catch(e=>{
            document.getElementById('errormessage').innerHTML=e.message;
            $("#myModal").modal('show');
            //console.log(e.message)
        });
    });
    signupbtn.addEventListener('click',event=>{
        event.preventDefault();
        const emailID=email.value;
        const Password=password.value;
        console.log('signing in');
        const promise=auth.createUserWithEmailAndPassword(emailID,Password).then(e=>{console.log(e.message)})
        .catch(e=>{
            document.getElementById('errormessage').innerHTML=e.message;
            $("#myModal").modal('show');
            //console.log(e.message)
            });
    });

    auth.onAuthStateChanged(firebaseUser=>{
        if(firebaseUser){
            console.log("logged in"); 
            //console.log(firebaseUser);             
            window.location.href="./index.html";                            
        }
        else{
            console.log("not logged in");
            //window.location.href="./index.html";
        }
    });
    function logoutUser(){
        auth.signOut();
    }
</script>
</body>
</html>
